<!-- Grid Variant -->
<div *ngIf="variant === 'grid'" class="card post-card-grid" (click)="handlePostClick()">
  <div *ngIf="post.media && post.media[0]" class="post-media">
    <img 
      [src]="post.media[0].url" 
      [alt]="post.media[0].alt || post.title"
      class="card-img-top"
      style="height: 200px; object-fit: cover;"
    >
  </div>
  <div class="card-body">
    <div class="d-flex align-items-center mb-2">
      <img 
        [src]="post.author.avatar" 
        [alt]="post.author.name"
        class="rounded-circle me-2"
        style="width: 24px; height: 24px; object-fit: cover;"
      >
      <small class="text-muted">{{ post.author.name }}</small>
    </div>
    <h6 class="card-title">{{ post.title }}</h6>
    <p class="card-text text-muted small">{{ post.excerpt }}</p>
  </div>
  <div class="card-footer bg-transparent">
    <div class="d-flex justify-content-between align-items-center">
      <div class="d-flex gap-3">
        <span class="text-muted small">
          <i class="bi bi-heart" [class.text-danger]="post.isLiked"></i> {{ post.likes }}
        </span>
        <span class="text-muted small">
          <i class="bi bi-chat"></i> {{ post.comments }}
        </span>
      </div>
    </div>
  </div>
</div>

<!-- Compact Variant -->
<div *ngIf="variant === 'compact'" class="card post-card-compact" (click)="handlePostClick()">
  <div class="card-body">
    <div class="d-flex gap-3">
      <img 
        [src]="post.author.avatar" 
        [alt]="post.author.name"
        class="rounded-circle"
        style="width: 40px; height: 40px; object-fit: cover;"
      >
      <div class="flex-grow-1">
        <div class="d-flex align-items-center mb-1">
          <span class="fw-medium">{{ post.author.name }}</span>
          <span class="text-muted mx-2">Â·</span>
          <small class="text-muted">{{ formatDate(post.createdAt) }}</small>
        </div>
        <h6 class="mb-1">{{ post.title }}</h6>
        <p class="text-muted small mb-2">{{ post.excerpt }}</p>
        <div class="d-flex gap-3 text-muted small">
          <span>
            <i class="bi bi-heart" [class.text-danger]="post.isLiked"></i> {{ post.likes }}
          </span>
          <span>
            <i class="bi bi-chat"></i> {{ post.comments }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Feed Variant (Default) -->
<div *ngIf="variant === 'feed'" class="card post-card-feed" (click)="handlePostClick()">
  <div class="card-body">
    <!-- Author Header -->
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div class="d-flex align-items-center">
        <img 
          [src]="post.author.avatar" 
          [alt]="post.author.name"
          class="rounded-circle me-3 cursor-pointer"
          style="width: 40px; height: 40px; object-fit: cover;"
          (click)="handleUserClick($event)"
        >
        <div>
          <div class="d-flex align-items-center gap-2">
            <span 
              class="fw-medium cursor-pointer"
              (click)="handleUserClick($event)"
            >
              {{ post.author.name }}
            </span>
            <button 
              *ngIf="!isOwner()"
              class="btn btn-sm"
              [class.btn-primary]="!post.isSubscribed"
              [class.btn-outline-primary]="post.isSubscribed"
              (click)="handleSubscribe($event)"
            >
              <i class="bi bi-person-plus" *ngIf="!post.isSubscribed"></i>
              <i class="bi bi-person-check" *ngIf="post.isSubscribed"></i>
              {{ post.isSubscribed ? 'Following' : 'Follow' }}
            </button>
          </div>
          <small class="text-muted">{{ formatDate(post.createdAt) }}</small>
        </div>
      </div>

      <div class="dropdown">
        <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="dropdown" (click)="$event.stopPropagation()">
          <i class="bi bi-three-dots"></i>
        </button>
        <ul class="dropdown-menu">
          <li>
            <button class="dropdown-item" (click)="handleShare($event)">
              <i class="bi bi-share me-2"></i>Share
            </button>
          </li>
          <li>
            <button class="dropdown-item" (click)="$event.stopPropagation()">
              <i class="bi bi-bookmark me-2"></i>Save
            </button>
          </li>
          <li *ngIf="!isOwner()">
            <button class="dropdown-item text-danger" (click)="handleReport($event)">
              <i class="bi bi-flag me-2"></i>Report
            </button>
          </li>
        </ul>
      </div>
    </div>

    <!-- Content -->
    <div class="mb-3">
      <h5 class="mb-2">{{ post.title }}</h5>
      <p class="text-muted mb-3">{{ post.excerpt }}</p>
      
      <!-- Tags -->
      <div *ngIf="post.tags.length > 0" class="mb-3">
        <span 
          *ngFor="let tag of post.tags" 
          class="badge bg-secondary me-2 mb-1"
        >
          #{{ tag }}
        </span>
      </div>
    </div>

    <!-- Media -->
    <div *ngIf="post.media && post.media.length > 0" class="mb-3">
      <div *ngIf="post.media.length === 1" class="post-media-single">
        <img 
          [src]="post.media[0].url" 
          [alt]="post.media[0].alt || post.title"
          class="img-fluid rounded"
          style="max-height: 400px; width: 100%; object-fit: cover;"
        >
      </div>
      <div *ngIf="post.media.length > 1" class="post-media-grid">
        <div class="row g-2">
          <div *ngFor="let media of post.media.slice(0, 4); let i = index" class="col-6">
            <div class="position-relative">
              <img 
                [src]="media.url" 
                [alt]="media.alt || post.title"
                class="img-fluid rounded"
                style="height: 120px; width: 100%; object-fit: cover;"
              >
              <div *ngIf="i === 3 && post.media!.length > 4" class="position-absolute top-0 start-0 w-100 h-100 bg-dark bg-opacity-50 rounded d-flex align-items-center justify-content-center">
                <span class="text-white fw-bold">+{{ post.media!.length - 4 }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="card-footer bg-transparent">
    <div class="d-flex justify-content-between align-items-center">
      <div class="d-flex gap-3">
        <button 
          class="btn btn-outline-danger btn-sm"
          [class.btn-danger]="post.isLiked"
          (click)="handleLike($event)"
        >
          <i class="bi bi-heart" [class.fill]="post.isLiked"></i>
          {{ post.likes }}
        </button>
        <button 
          class="btn btn-outline-primary btn-sm"
          (click)="handleComment($event)"
        >
          <i class="bi bi-chat"></i>
          {{ post.comments }}
        </button>
      </div>
      <button 
        class="btn btn-outline-secondary btn-sm"
        (click)="handleShare($event)"
      >
        <i class="bi bi-share"></i>
      </button>
    </div>
  </div>
</div>