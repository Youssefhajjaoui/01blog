<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <!-- Loading State -->
      <div *ngIf="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-muted">Loading post...</p>
      </div>

      <!-- Editor Content -->
      <div *ngIf="!loading" class="editor-container">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div class="d-flex align-items-center">
            <button class="btn btn-outline-secondary me-3" (click)="goBack()">
              <i class="bi bi-arrow-left"></i> Back
            </button>
            <h2 class="mb-0">{{ isEditing ? 'Edit Post' : 'Write New Post' }}</h2>
          </div>
          <div class="d-flex gap-2">
            <button 
              class="btn btn-outline-primary" 
              (click)="previewPost()"
              [disabled]="saving"
            >
              <i class="bi bi-eye"></i> Preview
            </button>
            <button 
              class="btn btn-secondary" 
              (click)="saveDraft()"
              [disabled]="saving"
            >
              <i class="bi bi-save"></i> Save Draft
            </button>
            <button 
              class="btn btn-primary" 
              (click)="publishPost()"
              [disabled]="saving"
            >
              <i class="bi bi-send" *ngIf="!saving"></i>
              <span class="spinner-border spinner-border-sm" *ngIf="saving"></span>
              {{ isEditing ? 'Update Post' : 'Publish' }}
            </button>
          </div>
        </div>

        <div class="row">
          <!-- Main Editor -->
          <div class="col-lg-8">
            <div class="card">
              <div class="card-body">
                <!-- Title -->
                <div class="mb-4">
                  <label for="postTitle" class="form-label fw-bold">Title</label>
                  <input 
                    type="text" 
                    class="form-control form-control-lg" 
                    id="postTitle"
                    [(ngModel)]="post.title"
                    placeholder="What's your post about?"
                    maxlength="200"
                  >
                  <div class="form-text">{{ post.title.length }}/200 characters</div>
                </div>

                <!-- Excerpt -->
                <div class="mb-4">
                  <label for="postExcerpt" class="form-label fw-bold">Excerpt</label>
                  <textarea 
                    class="form-control" 
                    id="postExcerpt"
                    [(ngModel)]="post.excerpt"
                    placeholder="Brief description of your post..."
                    rows="3"
                    maxlength="300"
                  ></textarea>
                  <div class="form-text">
                    {{ post.excerpt.length }}/300 characters
                    <button 
                      type="button" 
                      class="btn btn-sm btn-outline-secondary ms-2" 
                      (click)="generateExcerpt()"
                    >
                      Auto-generate
                    </button>
                  </div>
                </div>

                <!-- Content -->
                <div class="mb-4">
                  <label for="postContent" class="form-label fw-bold">Content</label>
                  <textarea 
                    class="form-control" 
                    id="postContent"
                    [(ngModel)]="post.content"
                    (ngModelChange)="onContentChange()"
                    placeholder="Write your post content here... You can use Markdown formatting."
                    rows="15"
                  ></textarea>
                  <div class="form-text">
                    <i class="bi bi-info-circle"></i> 
                    You can use Markdown formatting for rich text
                  </div>
                </div>

                <!-- Tags -->
                <div class="mb-4">
                  <label class="form-label fw-bold">Tags</label>
                  <div class="d-flex gap-2 mb-2">
                    <input 
                      type="text" 
                      class="form-control" 
                      [(ngModel)]="newTag"
                      placeholder="Add a tag..."
                      (keypress)="onKeyPress($event)"
                    >
                    <button 
                      type="button" 
                      class="btn btn-outline-primary" 
                      (click)="addTag()"
                    >
                      <i class="bi bi-plus"></i> Add
                    </button>
                  </div>
                  <div class="d-flex flex-wrap gap-2" *ngIf="post.tags.length > 0">
                    <span 
                      *ngFor="let tag of post.tags" 
                      class="badge bg-primary d-flex align-items-center gap-1"
                    >
                      #{{ tag }}
                      <button 
                        type="button" 
                        class="btn-close btn-close-white" 
                        (click)="removeTag(tag)"
                        style="font-size: 0.7em;"
                      ></button>
                    </span>
                  </div>
                  <div class="form-text">Add relevant tags to help others discover your post</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Sidebar -->
          <div class="col-lg-4">
            <!-- Visibility Settings -->
            <div class="card mb-4">
              <div class="card-header">
                <h5 class="mb-0">Publish Settings</h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label fw-bold">Visibility</label>
                  <select class="form-select" [(ngModel)]="post.visibility">
                    <option value="public">Public</option>
                    <option value="private">Private</option>
                    <option value="draft">Draft</option>
                  </select>
                  <div class="form-text">
                    <span *ngIf="post.visibility === 'public'">
                      <i class="bi bi-globe text-success"></i> Visible to everyone
                    </span>
                    <span *ngIf="post.visibility === 'private'">
                      <i class="bi bi-lock text-warning"></i> Only visible to you
                    </span>
                    <span *ngIf="post.visibility === 'draft'">
                      <i class="bi bi-file-text text-info"></i> Saved as draft
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Author Info -->
            <div class="card mb-4">
              <div class="card-header">
                <h5 class="mb-0">Author</h5>
              </div>
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <img 
                    [src]="currentUser.avatar" 
                    [alt]="currentUser.name"
                    class="rounded-circle me-3"
                    style="width: 40px; height: 40px; object-fit: cover;"
                  >
                  <div>
                    <div class="fw-bold">{{ currentUser.name }}</div>
                    <div class="text-muted small">Student</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Writing Tips -->
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Writing Tips</h5>
              </div>
              <div class="card-body">
                <ul class="list-unstyled small">
                  <li class="mb-2">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    Write a compelling title
                  </li>
                  <li class="mb-2">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    Use clear, concise language
                  </li>
                  <li class="mb-2">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    Add relevant tags
                  </li>
                  <li class="mb-2">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    Include code examples if applicable
                  </li>
                  <li class="mb-2">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    Share your learning journey
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
