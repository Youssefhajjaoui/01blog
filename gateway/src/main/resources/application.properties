# ==========================================================
# Gateway Application Configuration
# ==========================================================
spring.application.name=api-gateway
server.port=8080

# ==========================================================
# Redis Configuration for Rate Limiting
# ==========================================================
# IMPORTANT: Redis must be running for rate limiting to work!
# If Redis is not available, rate limiting will fail and may allow all requests through.
# Start Redis: docker run -d -p 6379:6379 redis:latest
# Or use: redis-server (if installed locally)
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=2000ms

# ==========================================================
# Backend Service Configuration
# ==========================================================
backend.url=${BACKEND_URL:http://localhost:9090}

# ==========================================================
# Gateway Security - CORS-based validation
# ==========================================================
# Shared secret for signing backend requests (set via env in production)
gateway.shared.secret=${GATEWAY_SHARED_SECRET:change-me}

# ==========================================================
# Rate Limiting Configuration
# ==========================================================
# Default rate limits (can be overridden per route)
ratelimit.default.replenishRate=1000
ratelimit.default.burstCapacity=2000
ratelimit.default.requestedTokens=1

# Auth endpoints - moderate limits (login, register, logout)
ratelimit.auth.replenishRate=30
ratelimit.auth.burstCapacity=60
ratelimit.auth.requestedTokens=1

# API endpoints - high limits for general API usage
ratelimit.api.replenishRate=500
ratelimit.api.burstCapacity=1000
ratelimit.api.requestedTokens=1

# Public endpoints - high limits for public read operations
ratelimit.public.replenishRate=300
ratelimit.public.burstCapacity=600
ratelimit.public.requestedTokens=1

# Posts endpoints - high limits for post browsing and creation
# Lowered for testing - should return 429 when exceeded
ratelimit.posts.replenishRate=100
ratelimit.posts.burstCapacity=200
ratelimit.posts.requestedTokens=1

# Comments endpoints - moderate limits
ratelimit.comments.replenishRate=100
ratelimit.comments.burstCapacity=200
ratelimit.comments.requestedTokens=1

# Likes endpoints - moderate limits
ratelimit.likes.replenishRate=100
ratelimit.likes.burstCapacity=200
ratelimit.likes.requestedTokens=1

# Subscription endpoints - moderate limits
ratelimit.subscriptions.replenishRate=50
ratelimit.subscriptions.burstCapacity=100
ratelimit.subscriptions.requestedTokens=1

# File upload endpoints - lower limits (resource intensive)
ratelimit.files.replenishRate=20
ratelimit.files.burstCapacity=40
ratelimit.files.requestedTokens=1

# Admin endpoints - moderate limits (rare operations)
ratelimit.admin.replenishRate=100
ratelimit.admin.burstCapacity=200
ratelimit.admin.requestedTokens=1

# SSE endpoints - very high limits (keep-alive connections)
ratelimit.sse.replenishRate=1000
ratelimit.sse.burstCapacity=2000
ratelimit.sse.requestedTokens=1

# Suggestions endpoints - high limits (autocomplete)
ratelimit.suggestions.replenishRate=200
ratelimit.suggestions.burstCapacity=400
ratelimit.suggestions.requestedTokens=1

# ==========================================================
# Actuator Configuration
# ==========================================================
management.endpoints.web.exposure.include=health,info,metrics,gateway
management.endpoint.health.show-details=always

# ==========================================================
# Logging
# ==========================================================
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.com.example.gateway=DEBUG
logging.level.reactor.netty.http.client=DEBUG

# ==========================================================
# CORS Configuration (if needed)
# ==========================================================
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedOrigins=${CORS_ORIGINS:http://localhost:4200,http://localhost:3000}
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedMethods=GET,POST,PUT,DELETE,PATCH,OPTIONS
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedHeaders=*
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowCredentials=true
spring.cloud.gateway.globalcors.corsConfigurations.[/**].maxAge=3600

